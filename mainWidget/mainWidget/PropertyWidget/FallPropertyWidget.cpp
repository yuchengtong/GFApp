#pragma once
#pragma execution_character_set("utf-8")
#include "FallPropertyWidget.h"
#include <QTableWidget>
#include <QHeaderView>
#include <QComboBox>
#include "ModelDataManager.h"

FallPropertyWidget::FallPropertyWidget(QWidget* parent)
	:BasePropertyWidget(parent)
{
	initWidget();
}

void FallPropertyWidget::initWidget()
{
	QVBoxLayout* vlayout = new QVBoxLayout(this);
	vlayout->setContentsMargins(0, 0, 0, 0);

	m_tableWidget = new QTableWidget(this);
	// 设置行列数，这里固定 3 行 2 列（对应示例里的 3 条属性），也可动态调整
	m_tableWidget->setRowCount(8);
	m_tableWidget->setColumnCount(4);
	// 隐藏表头（如果不需要显示表头文字，可根据需求决定是否隐藏）
	m_tableWidget->horizontalHeader()->setVisible(false);
	m_tableWidget->verticalHeader()->setVisible(false);


	// 设置第一列固定宽度（例如100像素）
	m_tableWidget->horizontalHeader()->setSectionResizeMode(0, QHeaderView::Fixed);
	m_tableWidget->horizontalHeader()->setSectionResizeMode(1, QHeaderView::Fixed);
	m_tableWidget->horizontalHeader()->resizeSection(0, 5);
	m_tableWidget->horizontalHeader()->resizeSection(1, 200);
	m_tableWidget->horizontalHeader()->resizeSection(3, 5);
	m_tableWidget->horizontalHeader()->setSectionResizeMode(2, QHeaderView::Stretch);
	m_tableWidget->horizontalHeader()->setSectionResizeMode(3, QHeaderView::Fixed);
	// 让表格充满布局，自动调整行列大小
	m_tableWidget->verticalHeader()->setSectionResizeMode(QHeaderView::Fixed);
	m_tableWidget->setColumnWidth(0, 5);
	// 合并第一行的第一和第二列
	m_tableWidget->setSpan(0, 0, 1, 4);

	vlayout->addWidget(m_tableWidget);
	setLayout(vlayout);

	QStringList labels = { "属性","测试项目","跌落高度", "跌落姿态", "跌落钢板硬度", "温度传感器数量","冲击波超压传感器数量","风速" };
	for (int row = 0; row < labels.size(); ++row) {
		QTableWidgetItem* serialItem = new QTableWidgetItem(QString::number(row));
		if (row == 0) {
			serialItem = new QTableWidgetItem("属性");
		}
		serialItem->setFlags(serialItem->flags() & ~Qt::ItemIsEditable); // 不可编辑
		m_tableWidget->setItem(row, 0, serialItem);

		QTableWidgetItem* labelItem = new QTableWidgetItem(labels[row]);
		labelItem->setFlags(labelItem->flags() & ~Qt::ItemIsEditable); // 不可编辑
		m_tableWidget->setItem(row, 1, labelItem);
	}

	// 设置列宽度
	QTableWidgetItem* colimnItem = m_tableWidget->item(6, 1);
	int itemWidth = QFontMetrics(m_tableWidget->font()).width(colimnItem->text());
	m_tableWidget->setColumnWidth(1, itemWidth + m_tableWidget->verticalHeader()->width());

	QStringList unitLabels = { " "," ","m", "°", " ", "个","个","m/s" };
	for (int row = 0; row < unitLabels.size(); ++row) {
		if (row != 0)
		{
			QTableWidgetItem* labelItem = new QTableWidgetItem(unitLabels[row]);
			labelItem->setFlags(labelItem->flags() & ~Qt::ItemIsEditable); // 不可编辑
			m_tableWidget->setItem(row, 3, labelItem);
		}

	}

	// 将第0行0列的单元格文本字体加粗
	QTableWidgetItem* headerItem = m_tableWidget->item(0, 0);
	if (headerItem) {
		QFont font = headerItem->font();
		font.setBold(true);
		headerItem->setFont(font);
	}

	QTableWidgetItem* titeItem = new QTableWidgetItem("跌落试验");
	titeItem->setFlags(titeItem->flags() & ~Qt::ItemIsEditable); // 不可编辑
	QTableWidgetItem* heightValueItem = new QTableWidgetItem("0");
	QTableWidgetItem* hardnessValueItem = new QTableWidgetItem("刚体");
	hardnessValueItem->setFlags(hardnessValueItem->flags() & ~Qt::ItemIsEditable); // 不可编辑
	QTableWidgetItem* temperatureSensorValueItem = new QTableWidgetItem("40");
	temperatureSensorValueItem->setFlags(temperatureSensorValueItem->flags() & ~Qt::ItemIsEditable); // 不可编辑
	QTableWidgetItem* overpressureSensorValueItem = new QTableWidgetItem("40");
	overpressureSensorValueItem->setFlags(overpressureSensorValueItem->flags() & ~Qt::ItemIsEditable); // 不可编辑
	QTableWidgetItem* airVelocityValueItem = new QTableWidgetItem("0");
	airVelocityValueItem->setFlags(airVelocityValueItem->flags() & ~Qt::ItemIsEditable); // 不可编辑

	m_tableWidget->setItem(1, 2, titeItem);
	m_tableWidget->setItem(2, 2, heightValueItem);

	QComboBox* postureComboBox = new QComboBox();
	postureComboBox->addItems({ "0", "45", "90" });
	m_tableWidget->setCellWidget(3, 2, postureComboBox);
	// 连接信号和槽
	QObject::connect(postureComboBox, QOverload<int>::of(&QComboBox::currentIndexChanged), [postureComboBox](int index) {
		QString value = postureComboBox->currentText();
		int angle = value.toInt();

		FallSettingInfo info = ModelDataManager::GetInstance()->GetFallSettingInfo();
		info.angle = angle;
		ModelDataManager::GetInstance()->SetFallSettingInfo(info);

		CalculationPropertyInfo m_calculationPropertyInfo = ModelDataManager::GetInstance()->GetCalculationPropertyInfo();
		QList<QString> calculation;
		if (angle == 0)
		{
			calculation = {
			"21.5318*A+0.0194*B+0.0000*C-0.2494*D+0.0193*E+0.0269*F-0.0000*G-0.4904*H+0.0415*I+0.0065*J-0.0493*K-0.6703*L-13.5786*M",
			"-1913.1332*A+0.0631*B+0.0000*C+0.6478*D-0.0608*E+0.1858*F-0.0000*G+1.9523*H-0.0042*I+0.0237*J-0.0058*K+2.4911*L+100.7872*M",
			"-1193.7939*A+0.0333*B+0.0000*C+1.3217*D-0.0832*E+0.1239*F+0.0000*G+0.3170*H-0.0271*I+0.0169*J-0.1005*K+2.3840*L+51.3554*M",
			"-1877.9646*A+0.0632*B+0.0000*C+0.6640*D-0.0716*E+0.1865*F-0.0000*G+1.6218*H-0.0011*I+0.0239*J-0.0234*K+2.5297*L+98.2791*M",
			"18.5237*A+0.0194*B+0.0000*C-0.2605*D+0.0194*E+0.0276*F-0.0000*G-0.4854*H+0.0407*I+0.0065*J-0.0474*K-0.6679*L-13.4602*M",
			"88.9088*A+0.0420*B+0.0000*C-1.0392*D-0.0118*E+0.1325*F-0.0000*G-0.3935*H+0.0719*I+0.0207*J-0.2300*K-0.4417*L-63.8459*M",
			"-238.5778*A+0.0041*B-0.0000*C+0.2595*D-0.0217*E+0.0338*F+0.0000*G+0.4805*H-0.0099*I+0.0036*J-0.0005*K+0.6810*L-0.3672*M",
			"-122.1322*A+0.0026*B-0.0000*C+0.1534*D-0.0183*E+0.0225*F+0.0000*G+0.1976*H-0.0058*I+0.0024*J-0.0211*K+0.4253*L-1.8724*M",
			"-237.7550*A+0.0042*B-0.0000*C+0.2624*D-0.0217*E+0.0335*F+0.0000*G+0.4934*H-0.0100*I+0.0036*J-0.0013*K+0.6779*L-0.3510*M",
			"64.9370*A+0.0420*B+0.0000*C-1.0402*D-0.0172*E+0.1302*F-0.0000*G-0.5280*H+0.0777*I+0.0206*J-0.2174*K-0.4406*L-64.0496*M",
			"77.3406*A+0.0248*B+0.0000*C-0.6045*D+0.0091*E+0.0988*F-0.0000*G-0.5802*H+0.0961*I+0.0147*J-0.1023*K-0.8176*L-50.9113*M",
			"-110.6043*A+0.0033*B+0.0000*C+0.1579*D-0.0117*E+0.0202*F+0.0000*G+0.3026*H+0.0002*I+0.0025*J-0.0077*K+0.1316*L+0.7883*M",
			"-76.1121*A+0.0025*B+0.0000*C+0.1049*D-0.0095*E+0.0176*F+0.0000*G+0.0990*H+0.0015*I+0.0020*J-0.0148*K+0.0705*L+1.0281*M",
			"-110.7208*A+0.0033*B+0.0000*C+0.1573*D-0.0118*E+0.0202*F+0.0000*G+0.3070*H+0.0002*I+0.0025*J-0.0075*K+0.1321*L+0.8091*M",
			"76.5164*A+0.0245*B+0.0000*C-0.6145*D+0.0117*E+0.0992*F-0.0000*G-0.5656*H+0.1013*I+0.0147*J-0.1026*K-0.8320*L-51.5045*M",
			"-694.6278*A+0.0455*B+0.0000*C-0.5442*D+0.0598*E+0.2649*F-0.0000*G+0.3780*H+0.1002*I+0.0316*J-0.3283*K+3.7371*L-101.4766*M",
			"-109.7874*A+0.0030*B+0.0000*C+0.1384*D-0.0073*E+0.0183*F+0.0000*G+0.2460*H+0.0026*I+0.0022*J-0.0020*K+0.1426*L+1.0918*M",
			"-138.3104*A+0.0031*B+0.0000*C+0.1431*D-0.0068*E+0.0217*F+0.0000*G+0.1444*H+0.0037*I+0.0024*J-0.0058*K+0.2022*L+3.1402*M",
			"-109.3954*A+0.0030*B+0.0000*C+0.1381*D-0.0072*E+0.0182*F+0.0000*G+0.2458*H+0.0028*I+0.0022*J-0.0022*K+0.1420*L+1.0652*M",
			"-692.2612*A+0.0454*B+0.0000*C-0.5559*D+0.0637*E+0.2656*F-0.0000*G+0.2209*H+0.1029*I+0.0316*J-0.3299*K+3.7233*L-101.6211*M",
			"-674.8931*A+0.0338*B+0.0000*C-0.4322*D+0.0727*E+0.2302*F-0.0000*G+1.0625*H+0.1003*I+0.0232*J-0.2966*K+3.1683*L-56.3468*M",
			"-77.9199*A+0.0014*B+0.0000*C+0.0972*D-0.0017*E+0.0129*F+0.0000*G+0.1729*H+0.0026*I+0.0014*J-0.0043*K+0.1606*L+0.5266*M",
			"-142.1110*A+0.0023*B+0.0000*C+0.1463*D-0.0005*E+0.0221*F+0.0000*G+0.2520*H+0.0057*I+0.0020*J+0.0102*K+0.1978*L+3.1599*M",
			"-77.4417*A+0.0014*B+0.0000*C+0.0973*D-0.0016*E+0.0129*F+0.0000*G+0.1705*H+0.0026*I+0.0013*J-0.0045*K+0.1602*L+0.5039*M",
			"-692.0747*A+0.0339*B+0.0000*C-0.4239*D+0.0715*E+0.2302*F-0.0000*G+1.0910*H+0.1004*I+0.0232*J-0.2904*K+3.1855*L-56.4163*M",
			"140.5368*A+0.0081*B+0.0000*C-0.1295*D+0.0322*E+0.0347*F-0.0000*G-0.0987*H+0.0655*I+0.0055*J-0.0201*K-0.9373*L-16.4131*M",
			"-20.8395*A+0.0009*B+0.0000*C+0.0451*D-0.0004*E+0.0055*F+0.0000*G+0.0358*H+0.0043*I+0.0006*J+0.0040*K-0.0468*L+0.4814*M",
			"-51.0432*A+0.0013*B+0.0000*C+0.0511*D+0.0022*E+0.0117*F+0.0000*G+0.1186*H+0.0073*I+0.0010*J+0.0140*K-0.0795*L+1.8213*M",
			"-20.8532*A+0.0009*B+0.0000*C+0.0451*D-0.0004*E+0.0055*F+0.0000*G+0.0373*H+0.0043*I+0.0006*J+0.0041*K-0.0474*L+0.4729*M",
			"133.4387*A+0.0082*B+0.0000*C-0.1363*D+0.0305*E+0.0352*F-0.0000*G-0.0152*H+0.0661*I+0.0055*J-0.0167*K-0.9431*L-16.1459*M",
			"76.1087*A+0.0042*B+0.0000*C-0.2895*D+0.0080*E+0.0491*F-0.0000*G+0.2943*H+0.0487*I+0.0063*J-0.0617*K-0.2377*L-19.7193*M",
			"-16.8568*A+0.0009*B+0.0000*C+0.0160*D+0.0003*E+0.0040*F+0.0000*G+0.0481*H+0.0017*I+0.0005*J+0.0014*K-0.0276*L+0.5890*M",
			"-45.4109*A+0.0017*B+0.0000*C+0.0055*D+0.0039*E+0.0085*F+0.0000*G+0.0961*H+0.0048*I+0.0008*J+0.0090*K-0.0433*L+1.7050*M",
			"-16.5876*A+0.0009*B+0.0000*C+0.0161*D+0.0004*E+0.0040*F+0.0000*G+0.0468*H+0.0018*I+0.0005*J+0.0014*K-0.0281*L+0.5775*M",
			"73.6455*A+0.0038*B+0.0000*C-0.2832*D+0.0087*E+0.0498*F-0.0000*G+0.3138*H+0.0510*I+0.0063*J-0.0602*K-0.2378*L-20.1816*M",
			"-121.5260*A+0.0286*B+0.0000*C-0.0337*D-0.0226*E-0.0075*F+0.0000*G-0.1776*H+0.0216*I+0.0051*J+0.0323*K-0.0420*L-5.4284*M",
			"-112.7293*A+0.0142*B+0.0000*C+0.0163*D+0.0047*E+0.0228*F+0.0000*G+0.5184*H+0.0677*I+0.0074*J-0.0766*K+0.0898*L-16.3086*M",
			"-199.9882*A+0.0120*B+0.0000*C+0.0586*D+0.0291*E+0.0798*F-0.0000*G+1.7482*H+0.0265*I+0.0094*J+0.1803*K+0.3600*L-28.9311*M",
			"-112.6211*A+0.0142*B+0.0000*C+0.0327*D+0.0052*E+0.0226*F+0.0000*G+0.4886*H+0.0684*I+0.0074*J-0.0745*K+0.0874*L-16.6976*M",
			"-113.9565*A+0.0280*B+0.0000*C+0.0057*D-0.0166*E-0.0048*F+0.0000*G-0.1665*H+0.0169*I+0.0051*J+0.0195*K-0.0274*L-4.8968*M"
			};
		}
		else if (angle == 45)
		{
			calculation = {
			"8.8212+0.0022*B+0.0000*C-0.0262*D+0.0009*E-0.0029*F+0.0000*G-0.0848*H+0.0015*I+0.0007*J-0.0096*K-0.1352*L+0.0134*M",
			"26.2662+0.0010*B+0.0000*C+0.0188*D-0.0034*E+0.0046*F-0.0000*G+0.0573*H-0.0013*I+0.0009*J-0.0145*K-0.1913*L-2.0589*M",
			"-25.2031+0.0071*B+0.0000*C+0.2227*D-0.0533*E+0.0463*F+0.0000*G+0.6496*H+0.0393*I+0.0054*J+0.1760*K-1.6087*L-13.3727*M",
			"-2075.7079+0.0389*B+0.0000*C-0.2793*D+0.1024*E+0.1980*F+0.0000*G-3.6566*H-0.1130*I+0.0411*J+0.5631*K+4.2419*L-40.2094*M",
			"-3930.1881+0.1257*B+0.0000*C+0.8890*D+0.2700*E+0.5506*F+0.0000*G-9.8482*H-0.1388*I+0.1172*J+1.0164*K+5.3683*L-278.1211*M",
			"24.6856+0.0011*B+0.0000*C-0.0034*D-0.0023*E+0.0052*F-0.0000*G+0.0448*H+0.0018*I+0.0008*J-0.0175*K-0.1644*L-2.2594*M",
			"-0.4681+0.0001*B+0.0000*C+0.0009*D-0.0002*E+0.0004*F+0.0000*G+0.0079*H+0.0004*I+0.0001*J-0.0003*K-0.0109*L+0.0128*M",
			"-4.5603+0.0002*B+0.0000*C-0.0061*D-0.0016*E+0.0019*F+0.0000*G+0.0314*H+0.0018*I+0.0001*J+0.0107*K-0.0492*L-0.1996*M",
			"-20.0065+0.0009*B+0.0000*C+0.0180*D-0.0019*E+0.0058*F+0.0000*G-0.1207*H-0.0053*I+0.0008*J+0.0138*K-0.1293*L+1.2594*M",
			"-7.1607+0.0235*B+0.0000*C-0.2931*D-0.0798*E+0.0629*F-0.0000*G-1.3003*H-0.0385*I+0.0160*J+0.0884*K-1.7970*L-9.6063*M",
			"32.2983+0.0011*B+0.0000*C-0.0207*D-0.0015*E+0.0042*F-0.0000*G-0.0031*H-0.0007*I+0.0007*J-0.0163*K-0.1627*L-1.8993*M",
			"-0.1636+0.0001*B+0.0000*C+0.0015*D-0.0002*E+0.0006*F+0.0000*G+0.0046*H+0.0003*I+0.0001*J-0.0002*K-0.0131*L-0.0002*M",
			"-4.6792+0.0001*B+0.0000*C-0.0011*D-0.0013*E+0.0014*F+0.0000*G+0.0379*H+0.0012*I+0.0001*J+0.0068*K-0.0341*L+0.0762*M",
			"4.7223+0.0008*B+0.0000*C+0.0127*D-0.0023*E+0.0050*F+0.0000*G-0.0184*H-0.0012*I+0.0006*J+0.0120*K-0.1824*L-0.4982*M",
			"116.9363+0.0171*B+0.0000*C-0.0076*D-0.0425*E+0.0523*F-0.0000*G-0.9990*H-0.0410*I+0.0099*J+0.0440*K-1.6734*L-17.1433*M",
			"63.9134+0.0011*B+0.0000*C-0.0424*D-0.0175*E+0.0061*F-0.0000*G-0.1514*H+0.0001*I+0.0014*J-0.0579*K-0.0863*L-2.5954*M",
			"1.1828+0.0000*B+0.0000*C-0.0005*D-0.0002*E+0.0005*F+0.0000*G+0.0072*H+0.0003*I+0.0001*J-0.0014*K-0.0110*L+0.0379*M",
			"-3.8458+0.0001*B+0.0000*C+0.0012*D-0.0004*E+0.0009*F+0.0000*G+0.0129*H+0.0001*I+0.0001*J+0.0008*K-0.0138*L+0.3531*M",
			"4.0096+0.0007*B+0.0000*C+0.0015*D-0.0022*E+0.0044*F+0.0000*G+0.0190*H-0.0001*I+0.0005*J+0.0129*K-0.1625*L-0.6813*M",
			"-116.3350+0.0235*B+0.0000*C-0.2989*D-0.0738*E+0.0666*F-0.0000*G-2.2767*H-0.0659*I+0.0166*J+0.0819*K-1.0645*L-11.4423*M",
			"65.1998+0.0012*B+0.0000*C-0.0672*D-0.0195*E+0.0068*F-0.0000*G+0.0235*H-0.0047*I+0.0014*J-0.0530*K-0.1115*L-1.7663*M",
			"0.2239+0.0000*B+0.0000*C-0.0006*D-0.0000*E+0.0006*F+0.0000*G+0.0142*H+0.0001*I+0.0001*J-0.0005*K-0.0128*L+0.0169*M",
			"-2.1697+0.0001*B+0.0000*C-0.0036*D-0.0006*E+0.0012*F+0.0000*G+0.0068*H+0.0001*I+0.0001*J+0.0047*K-0.0315*L-0.0255*M",
			"-1.7814+0.0003*B+0.0000*C+0.0021*D-0.0006*E+0.0014*F+0.0000*G+0.0329*H-0.0004*I+0.0002*J+0.0052*K-0.0556*L+0.0581*M",
			"-90.2063+0.0168*B+0.0000*C-0.1815*D-0.0620*E+0.0441*F-0.0000*G-1.5721*H-0.0528*I+0.0126*J+0.0717*K-0.7946*L-5.8759*M",
			"23.6208+0.0012*B+0.0000*C+0.0107*D+0.0001*E+0.0055*F-0.0000*G+0.1339*H-0.0035*I+0.0006*J-0.0104*K-0.1830*L-1.6663*M",
			"-0.4295+0.0001*B+0.0000*C-0.0011*D-0.0001*E+0.0006*F+0.0000*G+0.0044*H+0.0000*I+0.0001*J+0.0010*K-0.0160*L+0.0062*M",
			"-1.9615+0.0002*B+0.0000*C-0.0072*D-0.0012*E+0.0015*F+0.0000*G+0.0292*H+0.0007*I+0.0001*J+0.0105*K-0.0539*L-0.2955*M",
			"-1.8370+0.0003*B+0.0000*C-0.0047*D-0.0009*E+0.0013*F+0.0000*G+0.0575*H+0.0003*I+0.0001*J+0.0065*K-0.0535*L+0.0078*M",
			"84.4529+0.0111*B+0.0000*C+0.0819*D-0.0133*E+0.0258*F-0.0000*G-0.1037*H-0.0259*I+0.0047*J+0.0592*K-1.2926*L-6.0380*M",
			"19.2230+0.0016*B+0.0000*C+0.0320*D+0.0007*E+0.0048*F-0.0000*G+0.0394*H-0.0025*I+0.0008*J+0.0016*K-0.2229*L-1.8353*M",
			"-0.4594+0.0001*B+0.0000*C-0.0006*D+0.0001*E+0.0006*F+0.0000*G+0.0041*H+0.0000*I+0.0001*J+0.0009*K-0.0153*L-0.0237*M",
			"-2.1201+0.0001*B+0.0000*C-0.0124*D-0.0017*E+0.0021*F+0.0000*G+0.0405*H+0.0015*I+0.0001*J+0.0156*K-0.0750*L-0.5261*M",
			"-1.4163+0.0004*B+0.0000*C-0.0015*D-0.0008*E+0.0007*F+0.0000*G+0.0297*H+0.0004*I+0.0001*J+0.0046*K-0.0383*L-0.0774*M",
			"54.6312+0.0105*B+0.0000*C+0.0004*D-0.0206*E+0.0172*F-0.0000*G-0.0039*H-0.0121*I+0.0047*J+0.0584*K-1.1404*L-3.5252*M",
			"-9.3775+0.0030*B+0.0000*C-0.0140*D+0.0064*E+0.0005*F+0.0000*G-0.1440*H-0.0011*I+0.0008*J-0.0033*K-0.1557*L+0.1387*M",
			"8.0661+0.0028*B+0.0000*C+0.0143*D-0.0008*E+0.0029*F-0.0000*G+0.0386*H-0.0009*I+0.0010*J+0.0080*K-0.2537*L-1.8655*M",
			"-52.9411+0.0101*B+0.0000*C+0.1405*D-0.0261*E+0.0495*F+0.0000*G+0.6855*H+0.0313*I+0.0046*J+0.4608*K-2.7578*L-19.5332*M",
			"29.9274+0.0124*B+0.0000*C+0.1209*D-0.0247*E+0.0128*F+0.0000*G-0.3248*H-0.0032*I+0.0049*J+0.0456*K-0.6310*L-12.1232*M",
			"5.7541+0.0127*B+0.0000*C-0.1553*D+0.0177*E+0.0184*F+0.0000*G+0.1608*H-0.0092*I+0.0051*J-0.0422*K-0.0713*L-26.7789*M"
			};
		}
		else if (angle == 90)
		{
			calculation = {
			"-83.7199+0.0156*B+0.2385*D-0.0019*E+0.0059*F+0.0000*G-1.3005*H-0.0145*I+0.0055*J-0.0803*K+0.4517*L-3.2185*M",
			"-453.9937+0.0356*B+0.0000*C+0.3451*D-0.0500*E+0.0333*F+0.0000*G-0.2980*H+0.0370*I+0.0111*J+0.0417*K+1.3739*L-32.3968*M",
			"-140.4314+0.0362*B+0.0000*C-0.6501*D+0.0853*E+0.1327*F+0.0000*G+0.8347*H+0.0312*I+0.0153*J+0.2029*K-1.4154*L-32.3423*M",
			"147.4787+0.0633*B+0.0000*C-0.1942*D+0.0414*E+0.2681*F+0.0000*G-0.6602*H+0.0699*I+0.0316*J-0.5878*K+0.4561*L-108.8663*M",
			"-8690.4683+0.2585*B+0.0000*C+5.9651*D-0.0053*E+1.2614*F+0.0000*G-10.9112*H-0.9325*I+0.1523*J+4.3637*K+30.5971*L-678.3831*M",
			"-172.3491+0.0170*B+0.0000*C+0.0108*D+0.0035*E+0.0736*F-0.0000*G+0.6638*H+0.0065*I+0.0093*J-0.0656*K+0.9063*L-13.3709*M",
			"-31.9235+0.0014*B+0.0000*C+0.0236*D-0.0022*E+0.0075*F+0.0000*G+0.0107*H-0.0041*I+0.0008*J-0.0134*K+0.0771*L+0.0837*M",
			"-27.4376+0.0017*B+0.0000*C+0.0326*D-0.0016*E+0.0066*F+0.0000*G+0.2082*H-0.0021*I+0.0008*J-0.0026*K+0.0175*L-0.4156*M",
			"-42.7100+0.0016*B+0.0000*C+0.0186*D-0.0002*E+0.0075*F+0.0000*G+0.1156*H-0.0013*I+0.0008*J+0.0014*K+0.0490*L-0.4809*M",
			"-459.4851+0.0168*B+0.0000*C-0.3411*D+0.0020*E+0.1756*F-0.0000*G-1.6777*H-0.0310*I+0.0131*J+0.1966*K+2.1416*L-47.9075*M",
			"-97.6613+0.0173*B+0.0000*C+0.4123*D-0.0404*E+0.0636*F-0.0000*G-0.6626*H+0.0210*I+0.0108*J-0.0219*K+1.0836*L-12.1365*M",
			"-47.0605+0.0018*B+0.0000*C+0.0456*D-0.0077*E+0.0084*F+0.0000*G+0.2745*H-0.0050*I+0.0010*J-0.0003*K+0.1259*L-1.1702*M",
			"-51.2095+0.0016*B+0.0000*C+0.0094*D-0.0004*E+0.0111*F+0.0000*G+0.3079*H-0.0081*I+0.0011*J+0.0038*K+0.0489*L-0.1836*M",
			"-52.9808+0.0011*B+0.0000*C+0.0064*D+0.0012*E+0.0101*F+0.0000*G-0.0137*H-0.0058*I+0.0011*J-0.0024*K+0.1150*L-1.0370*M",
			"-300.6598+0.0265*B-0.0000*C+0.2099*D-0.0175*E+0.1242*F-0.0000*G-1.0699*H+0.0068*I+0.0143*J+0.1460*K+2.1614*L-44.2718*M",
			"-348.3307+0.0406*B+0.0000*C+0.8184*D-0.1350*E+0.0671*F-0.0000*G-1.6158*H+0.0831*I+0.0202*J-0.0826*K+3.2686*L-23.3450*M",
			"-62.7115+0.0035*B+0.0000*C+0.0478*D-0.0024*E+0.0023*F+0.0000*G-0.0641*H-0.0022*I+0.0009*J+0.0028*K+0.1511*L-0.2692*M",
			"-42.7693+0.0018*B+0.0000*C+0.0319*D-0.0040*E+0.0089*F+0.0000*G+0.1906*H-0.0047*I+0.0011*J+0.0042*K+0.0657*L-0.7479*M",
			"-53.4826+0.0017*B+0.0000*C+0.0503*D-0.0051*E+0.0073*F+0.0000*G+0.1343*H-0.0048*I+0.0011*J+0.0120*K+0.1193*L-1.1234*M",
			"-3592.0102+0.0510*B+0.0000*C-1.2048*D-0.0536*E+0.5998*F-0.0000*G+1.6824*H-0.2678*I+0.0592*J+2.0945*K+11.9058*L-322.7872*M",
			"-350.0945+0.0417*B+0.0000*C+0.8429*D-0.1408*E+0.0654*F-0.0000*G-1.6672*H+0.0822*I+0.0203*J-0.0789*K+3.2719*L-23.3839*M",
			"-63.0886+0.0035*B+0.0000*C+0.0481*D-0.0023*E+0.0027*F+0.0000*G-0.0731*H-0.0022*I+0.0010*J+0.0021*K+0.1525*L-0.3585*M",
			"-43.4964+0.0020*B+0.0000*C+0.0309*D-0.0045*E+0.0090*F+0.0000*G+0.1634*H-0.0057*I+0.0012*J+0.0031*K+0.0667*L-0.7966*M",
			"-53.0956+0.0017*B+0.0000*C+0.0446*D-0.0058*E+0.0078*F+0.0000*G+0.1406*H-0.0048*I+0.0011*J+0.0111*K+0.1201*L-1.1677*M",
			"-3583.3128+0.0500*B+0.0000*C-1.2722*D-0.0544*E+0.6014*F-0.0000*G+1.9038*H-0.2678*I+0.0588*J+2.0827*K+11.8565*L-320.0872*M",
			"-115.6633+0.0181*B+0.0000*C+0.4365*D-0.0461*E+0.0685*F-0.0000*G-0.7521*H+0.0202*I+0.0108*J-0.0112*K+1.0820*L-11.5412*M",
			"-48.7106+0.0019*B+0.0000*C+0.0500*D-0.0074*E+0.0087*F+0.0000*G+0.2691*H-0.0053*I+0.0011*J+0.0005*K+0.1280*L-1.2026*M",
			"-51.0877+0.0016*B+0.0000*C+0.0105*D-0.0002*E+0.0113*F+0.0000*G+0.3152*H-0.0080*I+0.0011*J+0.0032*K+0.0481*L-0.1930*M",
			"-52.6296+0.0011*B+0.0000*C+0.0056*D+0.0008*E+0.0103*F+0.0000*G-0.0083*H-0.0059*I+0.0011*J-0.0028*K+0.1152*L-1.0770*M",
			"-293.2695+0.0265*B-0.0000*C+0.1832*D-0.0207*E+0.1254*F-0.0000*G-1.1278*H+0.0042*I+0.0142*J+0.1477*K+2.1669*L-43.7177*M",
			"-186.0024+0.0174*B+0.0000*C+0.0138*D+0.0033*E+0.0745*F-0.0000*G+0.5093*H+0.0070*I+0.0092*J-0.0582*K+0.9134*L-13.1781*M",
			"-32.1425+0.0014*B+0.0000*C+0.0207*D-0.0025*E+0.0078*F+0.0000*G+0.0144*H-0.0038*I+0.0008*J-0.0135*K+0.0777*L+0.0197*M",
			"-27.5968+0.0017*B+0.0000*C+0.0313*D-0.0013*E+0.0067*F+0.0000*G+0.2074*H-0.0022*I+0.0008*J-0.0025*K+0.0174*L-0.4439*M",
			"-43.4687+0.0016*B+0.0000*C+0.0169*D-0.0004*E+0.0076*F+0.0000*G+0.1182*H-0.0009*I+0.0008*J+0.0013*K+0.0501*L-0.5026*M",
			"-467.2983+0.0170*B+0.0000*C-0.3441*D+0.0027*E+0.1783*F-0.0000*G-1.6088*H-0.0329*I+0.0132*J+0.1964*K+2.1274*L-47.6946*M",
			"-61.0620+0.0150*B+0.0000*C+0.1999*D-0.0069*E+0.0064*F+0.0000*G-1.3758*H-0.0056*I+0.0055*J-0.0928*K+0.4459*L-3.6181*M",
			"-456.1983+0.0353*B+0.0000*C+0.3076*D-0.0519*E+0.0346*F+0.0000*G-0.1706*H+0.0363*I+0.0113*J+0.0495*K+1.3952*L-33.0194*M",
			"-131.6773+0.0360*B+0.0000*C-0.6281*D+0.0840*E+0.1327*F+0.0000*G+0.8067*H+0.0309*I+0.0153*J+0.1972*K-1.4127*L-32.7582*M",
			"139.7315+0.0635*B+0.0000*C-0.2248*D+0.0435*E+0.2690*F+0.0000*G-0.6584*H+0.0685*I+0.0316*J-0.5853*K+0.4655*L-109.2879*M",
			"-8676.8431+0.2587*B+0.0000*C+5.8732*D-0.0162*E+1.2654*F+0.0000*G-10.8501*H-0.9346*I+0.1527*J+4.3595*K+30.6450*L-680.7320*M"
			};
		}
		m_calculationPropertyInfo.calculation = calculation;
		ModelDataManager::GetInstance()->SetCalculationPropertyInfo(m_calculationPropertyInfo);
	});

	m_tableWidget->setItem(4, 2, hardnessValueItem);
	m_tableWidget->setItem(5, 2, temperatureSensorValueItem);
	m_tableWidget->setItem(6, 2, overpressureSensorValueItem);
	m_tableWidget->setItem(7, 2, airVelocityValueItem);

	//文本左对齐
	for (int row = 0; row < m_tableWidget->rowCount(); ++row) {
		for (int col = 0; col < m_tableWidget->columnCount(); ++col) {
			QTableWidgetItem* item = m_tableWidget->item(row, col);
			if (item)
			{
				if (col == 0 && row != 0)
				{
					item->setTextAlignment(Qt::AlignCenter);
				}
				else
				{
					item->setTextAlignment(Qt::AlignLeft | Qt::AlignVCenter);
				}
			}
		}
	}

	// 遍历第2列（索引为1），将不可编辑单元格背景设置为浅灰色
	for (int row = 0; row < m_tableWidget->rowCount(); ++row) {
		// 遍历行，设置行高
		m_tableWidget->setRowHeight(row, 10);
		QTableWidgetItem* item = m_tableWidget->item(row, 2);
		if (item && !(item->flags() & Qt::ItemIsEditable))
		{
			item->setBackground(QBrush(QColor(230, 230, 230)));
		}
		if (row != 0)
		{
			QTableWidgetItem* unitItem = m_tableWidget->item(row, 3);
			unitItem->setBackground(QBrush(QColor(230, 230, 230)));
		}

	}


	connect(m_tableWidget, &QTableWidget::itemChanged, this, [this](QTableWidgetItem* item) {
		if (item->row() == 1 && item->column() == 2) {
			QString value = item->text();
			double numericValue = value.toDouble();

			FallSettingInfo info = ModelDataManager::GetInstance()->GetFallSettingInfo();
			info.high = numericValue;
			ModelDataManager::GetInstance()->SetFallSettingInfo(info);
		}
		});



}
